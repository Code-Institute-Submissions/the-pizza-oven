{% extends "base.html" %}

{% block content %}

<!-- Confirmation of booking -->
<div class="container-fluid px-0 customer-bookings">
    <div class="row booking-content booking-confirmation">
        <div class="col-12 col-md-10 col-lg-8 col-xl-6 mb-5 mx-auto bg-color-white booking-card txt-dark lead">
            <div class="row">
                <div class="col-12">
                    <h3 class="mt-2"><strong>Thank You!</strong></h3>
                    <hr class="m-0">
                    <p class="mt-3">We have a spare table and your booking has been made.</p>
                    <p>Your booking details are as follows:</p>
                </div>
            </div>
            <div class="row">
                <div class="col-12 col-sm-6 mt-2 mb-4">
                    <div class="booking-image-cont"></div>
                </div>
                <!-- Details of booking -->
                <div class="col-12 col-sm-6 mt-2 booking-info">
                    <p>The Pizza Oven</p>
                    <p>Table for {{ booking.party_size }} people</p>
                    <p>{{ booking.date }} at {{ booking.time|time:"H:i" }}</p>
                </div>
                <!-- Options to update or cancel booking if registered user -->
                {% if user.is_authenticated and booking.customer %}
                    <div class="col-12 mt-2">
                        <p class="mb-0">Click on the links below to change or cancel your booking:</p>
                        <a class="mb-2" href="{% url 'update_booking' booking.id %}"
                        aria-label="View and update the booking">Update</a>
                        <button class="btn-delete manage-delete mb-2"
                        data-delete-url="{% url 'delete_booking' booking.id %}">Cancel Booking</button>
                    </div>
                <!-- Restaurant contact details if not registered user -->
                {% else %}
                    <div class="col-12 mt-2 booking-contact">
                        <p>To change or cancel your booking please contact us on:</p>
                        <p class="mb-0">Phone: 020 7946 0441</p>
                        <p>Email: bookings@pizzaoven.com</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block top-content %}
<!-- Modal to confirm whether booking should be cancelled -->
<div class="modal fade" id="booking-delete-modal" tabindex="-1" role="alertdialog" aria-labelledby="modal-title"
    aria-describedby="modal-desc">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-title">Cancel Booking</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="modal-desc">Are you sure you want to cancel and delete the booking?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                <a href="#" id="manage-delete" class="btn btn-danger" aria-label="Delete the booking">Yes</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block postloadjs %}
<!-- Modal launch script, url for the confirm delete button taken from data-delete-url attribute -->
<script>
    // Adapted from https://stackoverflow.com/questions/54806538/how-to-pass-object-instance-to-a-href-tag-within-a-django-modal-dialog
    $(document).ready(function () {
        $(".manage-delete").click(function () {
            var del_url = $(this).data('delete-url');
            $("#manage-delete").attr("href", del_url);
            $("#booking-delete-modal").modal();
        });
    });
</script>
{% endblock %}